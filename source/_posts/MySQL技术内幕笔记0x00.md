---
title: MySQL技术内幕笔记0x00
date: 2019-08-28 10:13:09
categories: 数据库
tags:
  - MySQL
  - InnoDB
  - 表
---

# 表

## 索引组织表

- 在InnoDB存储引擎中，表都是根据主键顺序组织存放的，这种存储方式的表称为索引组织表。如果在创建表时没有显式地指定主键，则InnoDB会按以下方式选择或创建主键：
  - 首先判断表中是否有非空的唯一索引，如果有则该列为主键。该方式选择的根据是定义索引的顺序，而不是建表时列的顺序。
  - 否则，InnoDB存储引擎会自动创建一个6字节大小的指针。

## InnoDB逻辑存储结构

- 从InnoDB存储引擎的逻辑存储结构看，所有数据都被逻辑地存放在一个空间中，称之为表空间。表空间又由段、区、页组成。
- 表空间可以看作是InnoDB存储引擎逻辑结构的最高层 ，所有数据都存放在表空间中。
- 常见的段有数据段、索引段、回滚段等。数据段即为B+树的叶子节点，索引段为B+树的非叶子节点。
- 区是由连续页组成的空间，在任何情况下每个区的大小都为1MB。为了保证区中页的连续性，InnoDB存储引擎一次从磁盘中申请4~5个区。在默认情况下，InnoDB存储引擎页大小为16KB，即一个区中一共有64个连续的页。
- 页是InnoDB磁盘管理的最小单位。

## 约束

### 数据完整性

- 关系性数据库和文件系统的一个不同点是，关系数据库本身能保证存储数据的完整性，不需要应用程序的控制，而文件系统一般需要在程序端进行控制。
- 一般来说，数据完整性有以下三种形式：
  - 实体完整性保证表中有一个主键，可以通过定义Primary Key或Unique Key约束或者定义一个触发器来保证实体的完整性。
  - 域完整性保证数据每列的值满足特定的条件，可以选择合适的数据类型确保一个入局值满足特定条件，使用外键约束，编写触发器，或者考虑DEFAULT约束。
  - 参照完整性保证两张表之间的关系。可以使用外键以强制参照完整性，也可以使用触发器。